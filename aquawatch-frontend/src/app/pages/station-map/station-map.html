<div class="container my-4">

  <h2 class="mb-3">AquaWatch â€“ Carte / Dashboard des stations</h2>

  @if (loading) {
    <div class="alert alert-info">
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      Chargement des stations...
    </div>
  }

  @if (error) {
    <div class="alert alert-danger">
      {{ error }}
    </div>
  }

  @if (!loading && !error) {
    <!-- ðŸ—ºï¸ Carte Leaflet -->
    <div id="map" class="mb-3"></div>

    <!-- Tableau des stations -->
    <div class="card">
      <div class="card-header">
        Stations de mesure
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="table-light">
          <tr>
            <th>Code</th>
            <th>Nom</th>
            <th>QualitÃ© actuelle</th>
            <th>Score</th>
            <th>Alerte</th>
            <th>DerniÃ¨re mesure</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let st of stations">
            <td>{{ st.code }}</td>
            <td>{{ st.name }}</td>
            <td>
              <span [ngClass]="getStatusBadgeClass(st.currentStatus)">
                {{ st.currentStatus || 'N/A' }}
              </span>
            </td>
            <td>
              {{ st.currentScore !== null ? (st.currentScore | number:'1.0-1') + ' / 100' : 'N/A' }}
            </td>
            <td>
              <span *ngIf="st.hasActiveAlert" class="badge bg-danger">
                {{ st.latestAlertSeverity || 'ALERTE' }}
              </span>
              <span *ngIf="!st.hasActiveAlert" class="text-muted">Aucune</span>
            </td>
            <td>
              {{ st.lastMeasurementTime || 'â€“' }}
            </td>
            <td>
              <button class="btn btn-sm btn-outline-primary"
                      (click)="openDetail(st.stationId)">
                DÃ©tails
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  }
</div>
