<!-- src/app/pages/station-detail/station-detail.component.html -->
<div class="station-detail-container">
  
  <!-- Back Button -->
  <a routerLink="/stations" class="back-link animate-fade-in">
    <i class="bi bi-arrow-left-circle me-2"></i>
    Retour aux stations
  </a>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container animate-fade-in">
    <div class="loading-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <i class="bi bi-geo-alt-fill spinner-icon"></i>
    </div>
    <p class="loading-text">Chargement des détails...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container animate-fade-in">
    <div class="error-icon">
      <i class="bi bi-exclamation-triangle-fill"></i>
    </div>
    <p>{{ error }}</p>
    <a routerLink="/stations" class="btn btn-primary">
      <i class="bi bi-arrow-left me-2"></i>Retour
    </a>
  </div>

  <!-- Main Content -->
  <div *ngIf="detail && !loading && !error" class="detail-content">

    <!-- Page Header -->
    <div class="page-header animate-fade-in-down">
      <div class="header-content">
        <div class="header-icon animate-pulse">
          <i class="bi bi-geo-alt-fill"></i>
        </div>
        <div class="header-text">
          <h1>{{ detail.name }}</h1>
          <div class="header-meta">
            <span class="code-badge">
              <i class="bi bi-hash me-1"></i>{{ detail.code }}
            </span>
            <span class="commune-badge" *ngIf="detail.commune">
              <i class="bi bi-geo me-1"></i>{{ detail.commune }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="content-grid">

      <!-- Left Column -->
      <div class="left-column">
        
        <!-- Station Info Card -->
        <div class="info-card animate-fade-in-up stagger-1">
          <div class="card-header">
            <i class="bi bi-info-circle me-2"></i>
            Informations Station
          </div>
          <div class="card-body">
            <div class="info-item">
              <i class="bi bi-geo-alt"></i>
              <div>
                <label>Commune</label>
                <span>{{ detail.commune || 'N/A' }}</span>
              </div>
            </div>
            <div class="info-item">
              <i class="bi bi-card-text"></i>
              <div>
                <label>Description</label>
                <span>{{ detail.description || 'Aucune description' }}</span>
              </div>
            </div>
            <div class="info-item">
              <i class="bi bi-pin-map"></i>
              <div>
                <label>Coordonnées</label>
                <span class="coords">{{ detail.latitude }}, {{ detail.longitude }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Active Alerts Card -->
        <div class="alerts-card animate-fade-in-up stagger-2">
          <div class="card-header" [class.has-alerts]="detail.activeAlerts && detail.activeAlerts.length > 0">
            <i class="bi bi-exclamation-triangle me-2"></i>
            Alertes Actives
            <span class="alert-count" *ngIf="detail.activeAlerts?.length">
              {{ detail.activeAlerts.length }}
            </span>
          </div>
          <div class="card-body">
            <div *ngIf="detail.activeAlerts && detail.activeAlerts.length > 0; else noAlert">
              <div *ngFor="let a of detail.activeAlerts" class="alert-item">
                <span class="severity-badge" [class]="'severity-' + a.severity?.toLowerCase()">
                  <i class="bi bi-exclamation-circle-fill me-1"></i>
                  {{ a.severity }}
                </span>
                <div class="alert-content">
                  <strong>{{ a.title }}</strong>
                  <p>{{ a.message }}</p>
                </div>
              </div>
            </div>
            <ng-template #noAlert>
              <div class="empty-state">
                <i class="bi bi-shield-check"></i>
                <p>Aucune alerte active</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="right-column">

        <!-- Latest Measurement Card -->
        <div class="measurement-card animate-fade-in-up stagger-1">
          <div class="card-header">
            <i class="bi bi-speedometer2 me-2"></i>
            Dernière Mesure Capteur
          </div>
          <div class="card-body" *ngIf="detail.latestMeasurement; else noMeasurement">
            <div class="measurement-date">
              <i class="bi bi-calendar3 me-1"></i>
              {{ detail.latestMeasurement?.timestamp }}
            </div>
            <div class="measurements-grid">
              <div class="measurement-item">
                <div class="measurement-icon ph">
                  <i class="bi bi-droplet-half"></i>
                </div>
                <div class="measurement-data">
                  <label>pH</label>
                  <span>{{ detail.latestMeasurement?.ph }}</span>
                </div>
              </div>
              <div class="measurement-item">
                <div class="measurement-icon temp">
                  <i class="bi bi-thermometer-half"></i>
                </div>
                <div class="measurement-data">
                  <label>Température</label>
                  <span>{{ detail.latestMeasurement?.temperature }} °C</span>
                </div>
              </div>
              <div class="measurement-item">
                <div class="measurement-icon turbidity">
                  <i class="bi bi-water"></i>
                </div>
                <div class="measurement-data">
                  <label>Turbidité</label>
                  <span>{{ detail.latestMeasurement?.turbidity }} NTU</span>
                </div>
              </div>
              <div class="measurement-item">
                <div class="measurement-icon oxygen">
                  <i class="bi bi-wind"></i>
                </div>
                <div class="measurement-data">
                  <label>Oxygène Dissous</label>
                  <span>{{ detail.latestMeasurement?.dissolvedOxygen }} mg/L</span>
                </div>
              </div>
              <div class="measurement-item">
                <div class="measurement-icon conductivity">
                  <i class="bi bi-lightning"></i>
                </div>
                <div class="measurement-data">
                  <label>Conductivité</label>
                  <span>{{ detail.latestMeasurement?.conductivity }} µS/cm</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noMeasurement>
            <div class="card-body">
              <div class="empty-state">
                <i class="bi bi-speedometer"></i>
                <p>Aucune mesure disponible</p>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Water Quality Card -->
        <div class="quality-card animate-fade-in-up stagger-2">
          <div class="card-header">
            <i class="bi bi-clipboard2-pulse me-2"></i>
            Qualité Actuelle de l'Eau
          </div>
          <div class="card-body" *ngIf="detail.latestObservation; else noObs">
            <div class="quality-score-section">
              <div class="score-circle" [class]="getStatusClass(detail.latestObservation?.status)">
                <span class="score-value">{{ detail.latestObservation?.score | number:'1.0-0' }}</span>
                <span class="score-max">/100</span>
              </div>
              <div class="score-info">
                <span class="status-badge" [ngClass]="getStatusBadgeClass(detail.latestObservation?.status)">
                  {{ detail.latestObservation?.status }}
                </span>
                <p class="score-timestamp">
                  <i class="bi bi-clock me-1"></i>
                  {{ detail.latestObservation?.timestamp }}
                </p>
              </div>
            </div>
            <div class="quality-details" *ngIf="detail.latestObservation?.details">
              <i class="bi bi-info-circle me-1"></i>
              {{ detail.latestObservation?.details }}
            </div>
          </div>
          <ng-template #noObs>
            <div class="card-body">
              <div class="empty-state">
                <i class="bi bi-clipboard2-x"></i>
                <p>Aucune observation disponible</p>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Forecast Card -->
        <div class="forecast-card animate-fade-in-up stagger-3">
          <div class="card-header">
            <i class="bi bi-graph-up-arrow me-2"></i>
            Prévision (STModel)
          </div>
          <div class="card-body" *ngIf="detail.latestForecast; else noForecast">
            <div class="forecast-content">
              <div class="forecast-score-section">
                <div class="score-circle" [class]="getStatusClass(detail.latestForecast?.predictedStatus)">
                  <span class="score-value">{{ detail.latestForecast?.predictedScore | number:'1.0-0' }}</span>
                  <span class="score-max">/100</span>
                </div>
                <div class="score-info">
                  <span class="status-badge" [ngClass]="getStatusBadgeClass(detail.latestForecast?.predictedStatus)">
                    {{ detail.latestForecast?.predictedStatus }}
                  </span>
                  <p class="forecast-horizon">
                    <i class="bi bi-clock-history me-1"></i>
                    Horizon: {{ detail.latestForecast?.forecastTime }}
                  </p>
                </div>
              </div>
              <div class="model-info">
                <i class="bi bi-cpu me-1"></i>
                {{ detail.latestForecast?.modelName }} 
                <span class="version-tag">v{{ detail.latestForecast?.modelVersion }}</span>
              </div>
            </div>
          </div>
          <ng-template #noForecast>
            <div class="card-body">
              <div class="empty-state">
                <i class="bi bi-graph-down"></i>
                <p>Aucune prévision disponible</p>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Prediction History Card -->
        <div class="history-card animate-fade-in-up stagger-4">
          <div class="card-header">
            <i class="bi bi-clock-history me-2"></i>
            Historique des Prédictions
          </div>
          <div class="card-body">
            <div *ngIf="loadingHistory" class="loading-mini">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Chargement de l'historique...
            </div>
            <div *ngIf="!loadingHistory && predictionHistory.length === 0" class="empty-state">
              <i class="bi bi-clock"></i>
              <p>Aucune prédiction enregistrée</p>
              <a routerLink="/prediction" class="btn btn-primary btn-sm mt-2">
                <i class="bi bi-plus-circle me-1"></i>Faire une prédiction
              </a>
            </div>
            <div *ngIf="!loadingHistory && predictionHistory.length > 0" class="history-table-container">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Score</th>
                      <th>Status</th>
                      <th>pH</th>
                      <th>Temp</th>
                      <th>Turb</th>
                      <th>DO</th>
                      <th>Cond</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let h of predictionHistory; let i = index" 
                        class="table-row-animated" [style.animation-delay.ms]="i * 50">
                      <td class="date-cell">{{ h.predictionTimestamp | date:'dd/MM/yy HH:mm' }}</td>
                      <td>
                        <span class="score-badge" [style.color]="getScoreColor(h.score)">
                          {{ h.score | number:'1.1-1' }}
                        </span>
                      </td>
                      <td>
                        <span class="status-mini" [ngClass]="getStatusBadgeClass(h.status)">
                          {{ getStatusLabel(h.status) }}
                        </span>
                      </td>
                      <td class="param-cell">{{ h.ph | number:'1.1-1' }}</td>
                      <td class="param-cell">{{ h.temperature | number:'1.1-1' }}°C</td>
                      <td class="param-cell">{{ h.turbidity | number:'1.1-1' }}</td>
                      <td class="param-cell">{{ h.dissolvedOxygen | number:'1.1-1' }}</td>
                      <td class="param-cell">{{ h.conductivity | number:'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>
